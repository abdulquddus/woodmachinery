<?phpclass SiteController extends Controller{	/**	 * Declares class-based actions.	 */	public function actions()	{		return array(			// captcha action renders the CAPTCHA image displayed on the contact page			'captcha'=>array(				'class'=>'CCaptchaAction',				'backColor'=>0xFFFFFF,			),			// page action renders "static" pages stored under 'protected/views/site/pages'			// They can be accessed via: index.php?r=site/page&view=FileName			'page'=>array(				'class'=>'CViewAction',			),		);	}	/**	 * This is the default 'index' action that is invoked	 * when an action is not explicitly requested by users.	 */	public function actionIndex()	{		// renders the view file 'protected/views/site/index.php'		// using the default layout 'protected/views/layouts/main.php'                if(!isset(Yii::app()->session['adminuser']))                {                                     $this->redirect(array('site/login'));                }                		$this->render('index');	}	/**	 * This is the action to handle external exceptions.	 */	public function actionError()	{		if($error=Yii::app()->errorHandler->error)		{			if(Yii::app()->request->isAjaxRequest)				echo $error['message'];			else				$this->render('error', $error);		}	}                public function actionDetailticket(){                              if(!isset(Yii::app()->session['adminuser']))                {                                     $this->redirect(array('site/login'));                }                                                    if(isset($_POST['message']))    {          $date=date("Y-m-d");                  $sql="INSERT INTO `ticket_detail` (`ticket_id`, `subject`, `message`, `created_by`, `status`, `date`)"        . " VALUES ( '".$_POST['id']."', '', '".$_POST['message']."', ".Yii::app()->session['user'].", '1','$date' )";       $command = Yii::app()->db->createCommand($sql)->execute();                    }        $this->render('detail');}  public function actionTickets() {      if(!isset(Yii::app()->session['adminuser']))                {                                     $this->redirect(array('site/login'));                }                  // renders the view file 'protected/views/site/index.php'  // using the default layout 'protected/views/layouts/main.php'  $this->render('ticket'); }	/**	 * Displays the contact page	 */	public function actionContact()	{		$model=new ContactForm;		if(isset($_POST['ContactForm']))		{			$model->attributes=$_POST['ContactForm'];			if($model->validate())			{				$name='=?UTF-8?B?'.base64_encode($model->name).'?=';				$subject='=?UTF-8?B?'.base64_encode($model->subject).'?=';				$headers="From: $name <{$model->email}>\r\n".					"Reply-To: {$model->email}\r\n".					"MIME-Version: 1.0\r\n".					"Content-type: text/plain; charset=UTF-8";				mail(Yii::app()->params['adminEmail'],$subject,$model->body,$headers);				Yii::app()->user->setFlash('contact','Thank you for contacting us. We will respond to you as soon as possible.');				$this->refresh();			}		}		$this->render('contact',array('model'=>$model));	}	/**	 * Displays the login page	 *///	public function actionLogin()////	{////		$model=new LoginForm;////////		// if it is ajax validation request////		if(isset($_POST['ajax']) && $_POST['ajax']==='login-form')////		{////			echo CActiveForm::validate($model);////			Yii::app()->end();////		}////////		// collect user input data////		if(isset($_POST['LoginForm']))////		{////			$model->attributes=$_POST['LoginForm'];////			// validate user input and redirect to the previous page if valid////			if($model->validate() && $model->login())////				$this->redirect(Yii::app()->user->returnUrl);////		}////		// display the login form////		$this->render('login',array('model'=>$model));////	}        //        public function actionLogout()// {//              unset( Yii::app()->session['userid']);//  Yii::app()->user->logout();//  $this->redirect(Yii::app()->homeUrl);// }              public function actionLogin() {            if(!empty($_POST))            {//       //   print_r($_POST); exit;            $sql="select count(*) from user_reg where username ='".$_POST['username']."' and password ='".$_POST['password']."' and user_level=1 ";             $command = Yii::app()->db->createCommand($sql);$user= $command->queryRow();//print_r($user); exit;if($user['count(*)']==1){      $sql="select * from user_reg where username ='".$_POST['username']."' and password ='".$_POST['password']."' and user_level=1 ";             $command = Yii::app()->db->createCommand($sql);$user= $command->queryRow();//    Yii::app()->session['adminuser']=$user['id'];//     Yii::app()->session['roll']=$user['userlevel'];//     echo  Yii::app()->session['userid'];    $this->redirect(Yii::app()->baseUrl.'/index.php/site/index');//     //     } $this->render('login',array('erroe'=>1));//$this->redirect(Yii::app()->baseUrl.'/index.php?site/login=1');////            }// ////print_r($user);//  //            print_r($_POST); exit;// $this->render('login');    //       $this->redirect(Yii::app()->baseUrl.'/index.php');        }                                                                       	/**	 * Logs out the current user and redirect to homepage.	 */	public function actionLogout()	{                 unset(Yii::app()->session['adminuser']);                                   unset(Yii::app()->session['user']);                                		Yii::app()->user->logout();		$this->redirect(Yii::app()->homeUrl);	}}